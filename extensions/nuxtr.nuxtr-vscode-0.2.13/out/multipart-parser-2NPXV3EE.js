"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("./chunk-DFTLTOAG.js"),t=require("./chunk-IG6R7IBM.js"),r=t.__commonJS.call(void 0,{"node_modules/node-fetch-native/dist/chunks/multipart-parser.cjs"(r){var a=Object.defineProperty,n=(e,t)=>a(e,"name",{value:t,configurable:!0});t.__require.call(void 0,"fs"),t.__require.call(void 0,"path");var i=e.require_node.call(void 0);t.__require.call(void 0,"http"),t.__require.call(void 0,"https"),t.__require.call(void 0,"zlib"),t.__require.call(void 0,"stream"),t.__require.call(void 0,"buffer"),t.__require.call(void 0,"util"),e.require_node_fetch_native_61758d11.call(void 0),t.__require.call(void 0,"url"),t.__require.call(void 0,"net");var o=0,s={START_BOUNDARY:o++,HEADER_FIELD_START:o++,HEADER_FIELD:o++,HEADER_VALUE_START:o++,HEADER_VALUE:o++,HEADER_VALUE_ALMOST_DONE:o++,HEADERS_ALMOST_DONE:o++,PART_DATA_START:o++,PART_DATA:o++,END:o++},d=1,l=d,E=d*=2,_=n((e=>32|e),"lower"),c=n((()=>{}),"noop"),A=class{constructor(e){this.index=0,this.flags=0,this.onHeaderEnd=c,this.onHeaderField=c,this.onHeadersEnd=c,this.onHeaderValue=c,this.onPartBegin=c,this.onPartData=c,this.onPartEnd=c,this.boundaryChars={},e="\r\n--"+e;const t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r),this.boundaryChars[t[r]]=!0;this.boundary=t,this.lookbehind=new Uint8Array(this.boundary.length+8),this.state=s.START_BOUNDARY}write(e){let t=0;const r=e.length;let a=this.index,{lookbehind:i,boundary:o,boundaryChars:d,index:c,state:A,flags:h}=this;const u=this.boundary.length,D=u-1,f=e.length;let T,R;const b=n((e=>{this[e+"Mark"]=t}),"mark"),H=n((e=>{delete this[e+"Mark"]}),"clear"),p=n(((e,t,r,a)=>{(void 0===t||t!==r)&&this[e](a&&a.subarray(t,r))}),"callback"),P=n(((r,a)=>{const n=r+"Mark";n in this&&(a?(p(r,this[n],t,e),delete this[n]):(p(r,this[n],e.length,e),this[n]=0))}),"dataCallback");for(t=0;t<r;t++)switch(T=e[t],A){case s.START_BOUNDARY:if(c===o.length-2){if(45===T)h|=E;else if(13!==T)return;c++;break}if(c-1==o.length-2){if(h&E&&45===T)A=s.END,h=0;else{if(h&E||10!==T)return;c=0,p("onPartBegin"),A=s.HEADER_FIELD_START}break}T!==o[c+2]&&(c=-2),T===o[c+2]&&c++;break;case s.HEADER_FIELD_START:A=s.HEADER_FIELD,b("onHeaderField"),c=0;case s.HEADER_FIELD:if(13===T){H("onHeaderField"),A=s.HEADERS_ALMOST_DONE;break}if(c++,45===T)break;if(58===T){if(1===c)return;P("onHeaderField",!0),A=s.HEADER_VALUE_START;break}if(R=_(T),R<97||R>122)return;break;case s.HEADER_VALUE_START:if(32===T)break;b("onHeaderValue"),A=s.HEADER_VALUE;case s.HEADER_VALUE:13===T&&(P("onHeaderValue",!0),p("onHeaderEnd"),A=s.HEADER_VALUE_ALMOST_DONE);break;case s.HEADER_VALUE_ALMOST_DONE:if(10!==T)return;A=s.HEADER_FIELD_START;break;case s.HEADERS_ALMOST_DONE:if(10!==T)return;p("onHeadersEnd"),A=s.PART_DATA_START;break;case s.PART_DATA_START:A=s.PART_DATA,b("onPartData");case s.PART_DATA:if(a=c,0===c){for(t+=D;t<f&&!(e[t]in d);)t+=u;t-=D,T=e[t]}if(c<o.length)o[c]===T?(0===c&&P("onPartData",!0),c++):c=0;else if(c===o.length)c++,13===T?h|=l:45===T?h|=E:c=0;else if(c-1===o.length)if(h&l){if(c=0,10===T){h&=~l,p("onPartEnd"),p("onPartBegin"),A=s.HEADER_FIELD_START;break}}else h&E&&45===T?(p("onPartEnd"),A=s.END,h=0):c=0;if(c>0)i[c-1]=T;else if(a>0){const e=new Uint8Array(i.buffer,i.byteOffset,i.byteLength);p("onPartData",0,a,e),a=0,b("onPartData"),t--}break;case s.END:break;default:throw new Error(`Unexpected state entered: ${A}`)}P("onHeaderField"),P("onHeaderValue"),P("onPartData"),this.index=c,this.state=A,this.flags=h}end(){if(this.state===s.HEADER_FIELD_START&&0===this.index||this.state===s.PART_DATA&&this.index===this.boundary.length)this.onPartEnd();else if(this.state!==s.END)throw new Error("MultipartParser.end(): stream ended unexpectedly")}};n(A,"MultipartParser");var h=A;function u(e){const t=e.match(/\bfilename=("(.*?)"|([^()<>@,;:\\"/[\]?={}\s\t]+))($|;\s)/i);if(!t)return;const r=t[2]||t[3]||"";let a=r.slice(r.lastIndexOf("\\")+1);return a=a.replace(/%22/g,'"'),a=a.replace(/&#(\d{4});/g,((e,t)=>String.fromCharCode(t))),a}async function D(e,t){if(!/multipart/i.test(t))throw new TypeError("Failed to fetch");const r=t.match(/boundary=(?:"([^"]+)"|([^;]+))/i);if(!r)throw new TypeError("no or bad content-type header, no multipart boundary");const a=new h(r[1]||r[2]);let o,s,d,l,E,_;const c=[],A=new i.FormData,D=n((e=>{d+=b.decode(e,{stream:!0})}),"onPartData"),f=n((e=>{c.push(e)}),"appendToFile"),T=n((()=>{const e=new i.File(c,_,{type:E});A.append(l,e)}),"appendFileToFormData"),R=n((()=>{A.append(l,d)}),"appendEntryToFormData"),b=new TextDecoder("utf-8");b.decode(),a.onPartBegin=function(){a.onPartData=D,a.onPartEnd=R,o="",s="",d="",l="",E="",_=null,c.length=0},a.onHeaderField=function(e){o+=b.decode(e,{stream:!0})},a.onHeaderValue=function(e){s+=b.decode(e,{stream:!0})},a.onHeaderEnd=function(){if(s+=b.decode(),o=o.toLowerCase(),"content-disposition"===o){const e=s.match(/\bname=("([^"]*)"|([^()<>@,;:\\"/[\]?={}\s\t]+))/i);e&&(l=e[2]||e[3]||""),_=u(s),_&&(a.onPartData=f,a.onPartEnd=T)}else"content-type"===o&&(E=s);s="",o=""};for await(const t of e)a.write(t);return a.end(),A}n(u,"_fileName"),n(D,"toFormData"),r.toFormData=D}});exports.default=r();