"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("./chunk-JKS4TYHK.js");require("./chunk-37E2YH5C.js"),require("fs"),require("path"),require("http"),require("https"),require("zlib"),require("stream"),require("buffer"),require("util"),require("url"),require("net");var t=Object.defineProperty,r=(e,r)=>t(e,"name",{value:r,configurable:!0}),a=0,n={START_BOUNDARY:a++,HEADER_FIELD_START:a++,HEADER_FIELD:a++,HEADER_VALUE_START:a++,HEADER_VALUE:a++,HEADER_VALUE_ALMOST_DONE:a++,HEADERS_ALMOST_DONE:a++,PART_DATA_START:a++,PART_DATA:a++,END:a++},i=1,o=i,s=i*=2,d=r((e=>32|e),"lower"),E=r((()=>{}),"noop"),A=class{constructor(e){this.index=0,this.flags=0,this.onHeaderEnd=E,this.onHeaderField=E,this.onHeadersEnd=E,this.onHeaderValue=E,this.onPartBegin=E,this.onPartData=E,this.onPartEnd=E,this.boundaryChars={},e="\r\n--"+e;const t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r),this.boundaryChars[t[r]]=!0;this.boundary=t,this.lookbehind=new Uint8Array(this.boundary.length+8),this.state=n.START_BOUNDARY}write(e){let t=0;const a=e.length;let i=this.index,{lookbehind:E,boundary:A,boundaryChars:l,index:h,state:D,flags:c}=this;const u=this.boundary.length,f=u-1,T=e.length;let _,R;const b=r((e=>{this[e+"Mark"]=t}),"mark"),H=r((e=>{delete this[e+"Mark"]}),"clear"),p=r(((e,t,r,a)=>{(void 0===t||t!==r)&&this[e](a&&a.subarray(t,r))}),"callback"),P=r(((r,a)=>{const n=r+"Mark";n in this&&(a?(p(r,this[n],t,e),delete this[n]):(p(r,this[n],e.length,e),this[n]=0))}),"dataCallback");for(t=0;t<a;t++)switch(_=e[t],D){case n.START_BOUNDARY:if(h===A.length-2){if(45===_)c|=s;else if(13!==_)return;h++;break}if(h-1==A.length-2){if(c&s&&45===_)D=n.END,c=0;else{if(c&s||10!==_)return;h=0,p("onPartBegin"),D=n.HEADER_FIELD_START}break}_!==A[h+2]&&(h=-2),_===A[h+2]&&h++;break;case n.HEADER_FIELD_START:D=n.HEADER_FIELD,b("onHeaderField"),h=0;case n.HEADER_FIELD:if(13===_){H("onHeaderField"),D=n.HEADERS_ALMOST_DONE;break}if(h++,45===_)break;if(58===_){if(1===h)return;P("onHeaderField",!0),D=n.HEADER_VALUE_START;break}if(R=d(_),R<97||R>122)return;break;case n.HEADER_VALUE_START:if(32===_)break;b("onHeaderValue"),D=n.HEADER_VALUE;case n.HEADER_VALUE:13===_&&(P("onHeaderValue",!0),p("onHeaderEnd"),D=n.HEADER_VALUE_ALMOST_DONE);break;case n.HEADER_VALUE_ALMOST_DONE:if(10!==_)return;D=n.HEADER_FIELD_START;break;case n.HEADERS_ALMOST_DONE:if(10!==_)return;p("onHeadersEnd"),D=n.PART_DATA_START;break;case n.PART_DATA_START:D=n.PART_DATA,b("onPartData");case n.PART_DATA:if(i=h,0===h){for(t+=f;t<T&&!(e[t]in l);)t+=u;t-=f,_=e[t]}if(h<A.length)A[h]===_?(0===h&&P("onPartData",!0),h++):h=0;else if(h===A.length)h++,13===_?c|=o:45===_?c|=s:h=0;else if(h-1===A.length)if(c&o){if(h=0,10===_){c&=~o,p("onPartEnd"),p("onPartBegin"),D=n.HEADER_FIELD_START;break}}else c&s&&45===_?(p("onPartEnd"),D=n.END,c=0):h=0;if(h>0)E[h-1]=_;else if(i>0){const e=new Uint8Array(E.buffer,E.byteOffset,E.byteLength);p("onPartData",0,i,e),i=0,b("onPartData"),t--}break;case n.END:break;default:throw new Error(`Unexpected state entered: ${D}`)}P("onHeaderField"),P("onHeaderValue"),P("onPartData"),this.index=h,this.state=D,this.flags=c}end(){if(this.state===n.HEADER_FIELD_START&&0===this.index||this.state===n.PART_DATA&&this.index===this.boundary.length)this.onPartEnd();else if(this.state!==n.END)throw new Error("MultipartParser.end(): stream ended unexpectedly")}};r(A,"MultipartParser");var l=A;function h(e){const t=e.match(/\bfilename=("(.*?)"|([^()<>@,;:\\"/[\]?={}\s\t]+))($|;\s)/i);if(!t)return;const r=t[2]||t[3]||"";let a=r.slice(r.lastIndexOf("\\")+1);return a=a.replace(/%22/g,'"'),a=a.replace(/&#(\d{4});/g,((e,t)=>String.fromCharCode(t))),a}async function D(t,a){if(!/multipart/i.test(a))throw new TypeError("Failed to fetch");const n=a.match(/boundary=(?:"([^"]+)"|([^;]+))/i);if(!n)throw new TypeError("no or bad content-type header, no multipart boundary");const i=new l(n[1]||n[2]);let o,s,d,E,A,D;const c=[],u=new(0,e.dr),f=r((e=>{d+=b.decode(e,{stream:!0})}),"onPartData"),T=r((e=>{c.push(e)}),"appendToFile"),_=r((()=>{const t=new(0,e.wn)(c,D,{type:A});u.append(E,t)}),"appendFileToFormData"),R=r((()=>{u.append(E,d)}),"appendEntryToFormData"),b=new TextDecoder("utf-8");b.decode(),i.onPartBegin=function(){i.onPartData=f,i.onPartEnd=R,o="",s="",d="",E="",A="",D=null,c.length=0},i.onHeaderField=function(e){o+=b.decode(e,{stream:!0})},i.onHeaderValue=function(e){s+=b.decode(e,{stream:!0})},i.onHeaderEnd=function(){if(s+=b.decode(),o=o.toLowerCase(),"content-disposition"===o){const e=s.match(/\bname=("([^"]*)"|([^()<>@,;:\\"/[\]?={}\s\t]+))/i);e&&(E=e[2]||e[3]||""),D=h(s),D&&(i.onPartData=T,i.onPartEnd=_)}else"content-type"===o&&(A=s);s="",o=""};for await(const e of t)i.write(e);return i.end(),u}r(h,"_fileName"),r(D,"toFormData"),exports.toFormData=D;